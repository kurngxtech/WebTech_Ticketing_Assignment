<div class="analytics-page">
  <!-- Back Button -->
  <button class="back-button" (click)="goBack()" title="Go back">‚Üê Back</button>

  <!-- Main Content -->
  @if (currentEvent && analytics) {
  <div class="analytics-content">
    <!-- Event Header -->
    <div class="event-header animate-fade-in-up" style="animation-delay: 0.1s">
      <h1>{{ currentEvent.title }}</h1>
      @if (currentEvent.img) {
      <img [src]="currentEvent.img" [alt]="currentEvent.title" class="event-image">
      } @else {
      <div class="event-image-placeholder">Event Image</div>
      }
    </div>

    <!-- Quick Stats Grid -->
    <div class="quick-stats-grid animate-fade-in-up" style="animation-delay: 0.2s">
      <div class="stat-box">
        <p class="stat-label">Best Selling Ticket</p>
        <p class="stat-value">{{ getTopTicketType()?.type || 'N/A' }}</p>
      </div>
      <div class="stat-box">
        <p class="stat-label">Total Revenue</p>
        <p class="stat-value">{{ formatPrice(analytics.totalRevenue) }}</p>
      </div>
      <div class="stat-box">
        <p class="stat-label">Ticket Sold</p>
        <p class="stat-value">{{ analytics.totalTicketsSold }}</p>
      </div>
    </div>

    <!-- Chart Card Section -->
    <div class="chart-card animate-fade-in-up" style="animation-delay: 0.3s">
      <!-- Chart Header -->
      <div class="chart-header">
        <div class="chart-title-area">
          <p class="chart-statement">{{ getStatementText() }}</p>
          <p class="chart-value">{{ getStatementValue() }}</p>
        </div>
        <button class="time-toggle-btn" (click)="toggleTimePeriodMenu()" title="Time period">
          <span class="icon">‚ãÆ</span>
        </button>
      </div>

      <!-- Chart Display with Blur Effect -->
      <div class="chart-display" [class.blur]="showTimePeriodMenu">
        <svg class="line-chart" viewBox="0 0 1000 300" preserveAspectRatio="xMidYMid meet">
          <!-- Grid Lines -->
          <g class="grid">
            @for (i of [0,1,2,3,4]; track i) {
            <line [attr.x1]="0" [attr.y1]="i * 75" [attr.x2]="1000" [attr.y2]="i * 75" class="grid-line" />
            }
          </g>
          
          <!-- Chart Line -->
          @if (chartDataPoints.length > 0) {
          <polyline [attr.points]="getLinePoints()" class="chart-line" />
          
          <!-- Data Points -->
          @for (point of chartDataPoints; track $index) {
          <circle [attr.cx]="point.x" [attr.cy]="point.y" r="6" class="data-point" />
          }
          }
        </svg>

        <!-- Time Period Menu Overlay - Center -->
        @if (showTimePeriodMenu) {
        <div class="time-period-overlay">
          <div class="overlay-content">
            <button class="overlay-close-btn" (click)="closeTimePeriodMenu()" title="Close">‚úï</button>
            <p class="overlay-label">Select Time Period</p>
            <div class="period-buttons">
              <button
                class="period-option-btn"
                [class.active]="selectedTimePeriod === 'daily'"
                (click)="selectTimePeriod('daily')"
              >
                Daily
              </button>
              <button
                class="period-option-btn"
                [class.active]="selectedTimePeriod === 'weekly'"
                (click)="selectTimePeriod('weekly')"
              >
                Weekly
              </button>
              <button
                class="period-option-btn"
                [class.active]="selectedTimePeriod === 'monthly'"
                (click)="selectTimePeriod('monthly')"
              >
                Monthly
              </button>
            </div>
          </div>
        </div>
        }
      </div>

      <!-- Occupancy Box -->
      <div class="occupancy-section">
        <div class="occupancy-box">
          <p class="occupancy-label">Occupancy Rate</p>
          <p class="occupancy-value">{{ getOccupancyPercentage() }}%</p>
        </div>
      </div>
    </div>
  </div>
  } @else {
  <div class="empty-state">
    <p>Loading analytics data...</p>
  </div>
  }

  <!-- Print PDF Button -->
  <button class="print-button" (click)="printPDF()" title="Print as PDF">üñ®Ô∏è</button>
</div>
