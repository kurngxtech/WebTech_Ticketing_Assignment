<div class="eo-dashboard">
  <!-- Dashboard Top Bar with Profile and Logout -->
  <div class="dashboard-top-bar">
    <div class="top-bar-content">
      <h1 class="dashboard-title">Event Organizer Dashboard</h1>

      <div class="profile-section">
        @if (currentUser) {
        <div class="profile-info">
          <span class="profile-name">{{ currentUser.fullName }}</span>
          <span class="profile-role">{{ currentUser.role | uppercase }}</span>
        </div>

        <button class="logout-btn" (click)="logout()" title="Logout">
          <app-svg-icon name="logout" [size]="20" color="#feb706"></app-svg-icon>
        </button>
        }
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="dashboard-container">
    <!-- Events Section -->
    <div class="events-section">
      <div class="events-header">
        <h2>Your Events</h2>
      </div>

      @if (isLoading) {
      <div class="loading-state">
        <p>Loading your events...</p>
      </div>
      } @else if (eoEvents.length === 0) {
      <div class="empty-state">
        <p>No events yet. Start by creating your first event!</p>
        <button class="btn btn-primary" (click)="createNewEvent()">Create Event</button>
      </div>
      } @else {
      <div class="events-grid">
        @for (event of eoEvents; track event.id) {
        <div
          class="event-card"
          [class.blur-card]="expandedEventMenuId === event.id"
          (click)="closeEventMenu()"
        >
          <!-- Event Image -->
          <div class="event-image-section">
            @if (event.img) {
            <img [src]="event.img" [alt]="event.title" class="event-image" />
            } @else {
            <div class="image-placeholder">
              <app-svg-icon name="camera" [size]="48" color="#666"></app-svg-icon>
            </div>
            }
            <div class="event-status-badge" [ngClass]="getStatusBadgeClass(event.status)">
              {{ getStatusText(event.status) }}
            </div>
          </div>

          <!-- Event Content -->
          <div class="event-content">
            <div class="event-header">
              <h3 class="event-title">{{ event.title }}</h3>
              <div class="event-meta">
                <p class="tickets-sold">
                  <strong>Total Tickets Sold:</strong> {{ getTotalTicketsSold(event) }}
                </p>
              </div>
            </div>

            <!-- Event Details -->
            <div class="event-details">
              <div class="detail-item">
                <span class="detail-label"
                  ><app-svg-icon name="location" [size]="14"></app-svg-icon> Location:</span
                >
                <span class="detail-text">{{ event.location }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label"
                  ><app-svg-icon name="calendar" [size]="14"></app-svg-icon> Date:</span
                >
                <span class="detail-text">{{ event.date }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label"
                  ><app-svg-icon name="money" [size]="14"></app-svg-icon> Revenue:</span
                >
                <span class="detail-text">{{ formatPrice(getTotalRevenue(event)) }}</span>
              </div>
            </div>
          </div>

          <!-- Event Menu Button -->
          <div class="event-menu-container">
            <button
              class="event-menu-btn"
              (click)="toggleEventMenu(event.id, $event)"
              title="Event options"
            >
              @if (!expandedEventMenuId || expandedEventMenuId !== event.id) {
              <app-svg-icon name="menu-horizontal" [size]="20"></app-svg-icon>
              } @else {
              <app-svg-icon name="close" [size]="20"></app-svg-icon>
              }
            </button>
          </div>

          <!-- Event Action Menu Overlay - Cover entire card -->
          @if (expandedEventMenuId === event.id) {
          <div class="event-action-overlay" (click)="$event.stopPropagation()">
            <!-- Close Button -->
            <button
              class="overlay-close-btn"
              (click)="toggleEventMenu(event.id, $event)"
              title="Close menu"
            >
              <app-svg-icon name="close" [size]="20"></app-svg-icon>
            </button>

            <div class="action-group">
              <div class="action-buttons">
                <button class="action-item edit" (click)="editEvent(event)">
                  <app-svg-icon name="edit" [size]="18"></app-svg-icon> Edit Event
                </button>
                <button class="action-item analysis" (click)="viewAnalytics(event)">
                  <app-svg-icon name="chart" [size]="18"></app-svg-icon> In-depth Analysis
                </button>
                <button class="action-item delete" (click)="deleteEvent(event)">
                  <app-svg-icon name="trash" [size]="18"></app-svg-icon> Delete Event
                </button>
              </div>
            </div>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
  </div>

  <!-- Create New Event Button (Fixed) -->
  @if (!isLoading && eoEvents.length > 0) {
  <button class="create-event-btn" (click)="createNewEvent()" title="Create new event">
    <span class="btn-icon">+</span>
    <span class="btn-text">Create New Event</span>
  </button>
  }
</div>
